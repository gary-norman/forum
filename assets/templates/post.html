{{ define "post" }}
    {{- /*gotype: github.com/gary-norman/forum/internal/models.Post*/ -}}
    {{ $channelBasePath := "db/userdata/images/channel-images/" }}
    {{ $postBasePath := "db/userdata/images/post-images/" }}
    {{ $userBasePath := "db/userdata/images/user-images/" }}
    {{ $userID := 0 }} <!-- Default value for logged out users -->
    {{ if ne .CurrentUser nil }}
        {{ $userID = .CurrentUser.ID }}
    {{ end }}
    {{ $post := .Post }}
    <div class="container-card-down">
        <div class="card" data-post-id="{{$post.ID}}" data-channel-ID="{{$post.ChannelID}}" data-author-ID="{{$post.AuthorID}}">
            <div class="container-post-info">
                {{ if (ne $post.AuthorAvatar "noimage") }}
                    <span class="card-pic profile-pic" data-image-auth="{{ $userBasePath }}{{ $post.AuthorAvatar }}"></span>
                {{ else }}
                    <span class="card-pic profile-pic--empty" data-name-user="{{ $post.Author }}"></span>
                {{ end }}
                <div>
                    <small class="small-bold">{{$post.Author}}</small>
                    <div>
                        <small>{{$post.ChannelName}}</small>
                        <small>-</small>
                        <small>{{$post.TimeSince}}</small>
                        <small>PostID: {{$post.ID}}</small>
                    </div>
                </div>
                <div class="like-button">
                    <button data-tooltip-name="like" class="btn-icoonly"></button>
                </div>
            </div>
            <h4>{{$post.Title}}</h4>
            {{ if ne $post.Images "noimage" }}
                <img src={{$postBasePath}}{{$post.Images}} class="post-image" alt="Post Image">
            {{ end }}
            <pre class="cardContent">{{$post.Content}}</pre>
            <!--  Post control buttons -->
            <div class="button-row-wrap post-controls" >
                {{$status := reactionStatus $userID $post.ID 0}}
                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action {{if $status.Liked}}active{{end}}" >
                    <span class="btn-likes" data-like-ID="user-{{$post.ID}}">{{$post.Likes}}</span>
                </button>
                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action {{if $status.Disliked}}active{{end}}">
                    <span class="btn-dislikes" data-dislike-ID="user-{{$post.ID}}">{{$post.Dislikes}}</span>
                </button>
                <button id="reply-button-channel-{{$post.ChannelID}}-post-{{$post.ID}}" class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                    <span class="btn-reply">reply</span>
                </button>
                <button id="share-button-channel-{{$post.ChannelID}}-post-{{$post.ID}}" popovertarget="share-container-channel-{{$post.ChannelID}}-post-{{$post.ID}}" class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                    <span class="btn-share">share</span>
                </button>
                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                    <span class="btn-report">report</span>
                </button>
                <!--  Share modal -->
                <div popover id="share-container-channel-{{$post.ChannelID}}-post-{{$post.ID}}" class="scrollable-user">
                    <div class="share-container">
                        <div class="button-row">
                            <a href="/" target="_blank" class="share-logo facebook"></a>
                            <a href="/" target="_blank" class="share-logo twitter"></a>
                            <a href="/" target="_blank" class="share-logo linkedin"></a>
                            <a href="/" target="_blank" class="share-logo reddit"></a>
                            <a href="/" target="_blank" class="share-logo whatsapp"></a>
                            <a href="/" target="_blank" class="share-logo telegram"></a>
                        </div>
                        <div class="flex-space-between">
                            <label class="padded" for="copy-url-channel-{{$post.ChannelName}}-post-{{$post.ID}}">Copy URL link</label>
                            <button class="btn-sm btn-icoonly">
                                <span class="btn-copy" aria-label="Copy URL link"></span>
                            </button>
                        </div>
                        <input value="https://localhost:8989/URL-exampleasdasdasdsad" readonly type="text"
                               id="copy-url-channel-{{$post.ChannelName}}-post-{{$post.ID}}" name="copy-url-channel-{{$post.ChannelName}}-post-{{$post.ID}}"/>
                    </div>
                </div>
            </div>
            <!--  Reply / Submit Comment form -->
            <form class="form-reply" action="/store-comment" enctype="multipart/form-data" method="POST">
                <div class="cont-flex-row flex-end">
                    <div class="input-wrapper container-reply">
                        <textarea id="comment-form-textarea-{{$post.ID}}" name="content" placeholder="Type a reply..."></textarea>
                        <label for="comment-form-textarea-{{$post.ID}}" class="user-label">Reply</label>
                    </div>
                    <!-- Hidden input to store the postID -->
                    <input type="hidden" name="postID" value="{{$post.ID}}">
                    <input type="hidden" name="channel" value='{"channelName": "{{$post.ChannelName}}", "channelID": "{{$post.ChannelID}}"}'>
                    <button class="btn-md btn-primary btn-icotext btn-action-primary btn-invert-onoff_onoff">
                        <span class="btn-reply-comment">comment</span>
                    </button>
                </div>
            </form>
        </div> <!-- end post card -->
        {{ range .Comments}}
            <div class="container-card-across">
                {{ $comment := . }}
                <div class="reply-arrow"></div>
                <div class="container-card-down">
                    <div class="card" data-comment-id="{{$comment.ID}}" data-channel-ID="{{$comment.ChannelID}}" data-author-ID="{{$comment.AuthorID}}">
                            <div class="container-post-info">
                                {{ if (ne $comment.AuthorAvatar "noimage") }}
                                    <span class="card-pic profile-pic" data-image-auth="{{ $userBasePath }}{{ $comment.AuthorAvatar }}"></span>
                                {{ else }}
                                    <span class="card-pic profile-pic--empty" data-name-user="{{ $comment.Author }}"></span>
                                {{ end }}
                                <div>
                                    <small class="small-bold">{{$comment.Author}}</small>
                                    <div>
                                        <small>{{$comment.ChannelName}}</small>
                                        <small>-</small>
                                        <small>{{.TimeSince}}</small>
                                        <small>commentID: {{$comment.ID}}</small>
                                    </div>
                                </div>
                                <div class="like-button">
                                    <button data-tooltip-name="like" class="btn-icoonly"></button>
                                </div>
                            </div>
                            <pre class="cardContent">{{$comment.Content}}</pre>
                            <!--  Post control buttons -->
                            <div class="button-row-wrap post-controls" >
                                {{$status := reactionStatus $userID 0 $comment.ID}}
                                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action {{if $status.Liked}}active{{end}}" >
                                    <span class="btn-likes" data-like-ID="user-{{$comment.ID}}">{{$comment.Likes}}</span>
                                </button>
                                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action {{if $status.Disliked}}active{{end}}">
                                    <span class="btn-dislikes" data-dislike-ID="user-{{$comment.ID}}">{{$comment.Dislikes}}</span>
                                </button>
                                <button id="reply-button-channel-{{$comment.ChannelID}}-comment-{{$comment.ID}}" class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                                    <span class="btn-reply">reply</span>
                                </button>
                                <button id="share-button-channel-{{$comment.ChannelID}}-comment-{{$comment.ID}}" popovertarget="share-container-channel-{{$comment.ChannelID}}-comment-{{$comment.ID}}" class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                                    <span class="btn-share">share</span>
                                </button>
                                <button class="btn-md btn-secondary btn-icotext btn-filled btn-action">
                                    <span class="btn-report">report</span>
                                </button>
                                <!--  Share modal -->
                                <div popover id="share-container-channel-{{$comment.ChannelID}}-comment-{{$comment.ID}}" class="scrollable-user">
                                    <div class="share-container">
                                        <div class="button-row">
                                            <a href="/" target="_blank" class="share-logo facebook"></a>
                                            <a href="/" target="_blank" class="share-logo twitter"></a>
                                            <a href="/" target="_blank" class="share-logo linkedin"></a>
                                            <a href="/" target="_blank" class="share-logo reddit"></a>
                                            <a href="/" target="_blank" class="share-logo whatsapp"></a>
                                            <a href="/" target="_blank" class="share-logo telegram"></a>
                                        </div>
                                        <div class="flex-space-between">
                                            <label class="padded" for="copy-url-channel-{{$post.ChannelID}}-comment-{{$comment.ID}}">Copy URL link</label>
                                            <button class="btn-sm btn-icoonly">
                                                <span class="btn-copy" aria-label="Copy URL link"></span>
                                            </button>
                                        </div>
                                        <input value="https://localhost:8989/URL-exampleasdasdasdsad" readonly type="text"
                                               id="copy-url-channel-{{$post.ChannelID}}-comment-{{$comment.ID}}" name="copy-url-channel-{{$post.ChannelID}}-comment-{{$comment.ID}}"/>
                                    </div>
                                </div>
                            </div>
                            <!--  Reply / Submit Comment form -->
                            <form class="form-reply" action="/store-comment" enctype="multipart/form-data" method="POST">
                                <div class="cont-flex-row flex-end">
                                    <div class="input-wrapper container-reply">
                                        <textarea id="comment-form-textarea-{{$comment.ID}}" name="content" placeholder="Type a reply..."></textarea>
                                        <label for="comment-form-textarea-{{$comment.ID}}" class="user-label">Reply</label>
                                    </div>
                                    <!-- Hidden input to store the commentID (if replying to a comment) -->
                                    <input type="hidden" name="commentID" value="{{$comment.ID}}">
                                    <input type="hidden" name="channel" value='{"channelName": "{{$comment.ChannelName}}", "channelID": "{{$comment.ChannelID}}"}'>
                                    <button type="submit" class="btn-md btn-primary btn-icotext btn-action-primary btn-invert-onoff_onoff">
                                        <span class="btn-reply-comment">comment</span>
                                    </button>
                                </div>
                            </form>
                        </div> <!-- end comment card-->

                    <!-- Recursively Render Replies -->
                    {{ if .Replies}}
                        {{ range .Replies }}
                                <div class="container-card-across">
                                    {{ template "reply_level1" (dict "CurrentUser" $.CurrentUser "Comment" . ) }}
                                </div> <!-- end container-comment-across wrapper -->
                            {{ end }} <!-- end range Replies -->
                        {{ end }} <!-- end if Replies -->

                </div> <!-- end container-comment-down wrapper -->
            </div> <!-- end container-comment-across -->
        {{end}} <!-- range .Comments -->
    </div> <!-- end container-comments wrapper -->
{{end}} <!-- end define block -->